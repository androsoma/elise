<f:view xmlns:h="http://xmlns.jcp.org/jsf/html" 
        xmlns:f="http://xmlns.jcp.org/jsf/core"
        xmlns:pm="http://primefaces.org/mobile"
        xmlns:p="http://primefaces.org/ui">

    <pm:page title="mapa">
        <f:facet name="postinit">
            <h:outputScript library="primefaces" name="gmap/gmap.js" />
            <h:outputScript library="primefaces" name="jquery/jquery.js" />
            <h:outputScript library="primefaces-mobile" name="jquery/primefaces-mobile.js" />
            <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>

            <script type="text/javascript">

                var map;    //define el componente map del formulario
                var centro; //coordenadas del centro del mapa
                var marcador; //marcador para localizar la posicion


                //localiza al usuario a traves de l navegador
                function localizar()
                {
                    navigator.geolocation.getCurrentPosition(mostrarMapa, error);
                }


                //define el centro basado en las coordenadas de ubicacion
                //del usuario
                function mostrarMapa(pos)
                {
                    var contenedor = document.getElementById("formMap:gmap");
                    var latitud = pos.coords.latitude;
                    var longitud = pos.coords.longitude;

                    centro = new google.maps.LatLng(latitud, longitud);

                    var propiedadesMapa = {
                        zoom: 18,
                        center: centro,
                        draggable: true,
                        mapTypeId: google.maps.MapTypeId.ROADMAP,
                        mapTypeControl: false
                    };

                    map = new google.maps.Map(contenedor, propiedadesMapa);

                    //enableHighAccuracy: true;

                    adicionarMarcador();


                    //google.maps.event.addListener(marcador, "click", mostrarCoordenadasMarker);

                    resize_map();
                    //google.maps.event.trigger(map, 'resize');
                }

                //muestra las coordenadas del marker
                function mostrarCoordenadasMarker(evento)
                {
                    var lat = evento.latLng.lat();
                    var lon = evento.latLng.lng();

                    var str = "latitud: " + lat + ", longutud: " + lon;

                    var infowindow = new google.maps.InfoWindow({
                        content: str
                    });

                    infowindow.open(map, marcador);
                }

                //captura los errores de la geolocalizacion
                function error(errorC)
                {
                    if (erroC.code == 0)
                        alert("Error desconocido");
                    else if (errorC.code == 1)
                        alert("No se pudo ubicar al usuario");
                    else if (errorC.code == 2)
                        alert("Posicion no disponible");
                    else if (errorC.code == 3)
                        alert("no se pudo ubicar el punto");
                }

                //adiciona un marcador 
                function adicionarMarcador()
                {
                    marcador = new google.maps.Marker({
                        position: centro,
                        map: map,
                        draggable: true
                    });
                }

                function resize_map() {
                    var iWidth = $(window).width();
                    var iHeight = $(window).height();

                    $("#gmap").height(iHeight - 155 - 65 - 15 - 2 - 51);

                    $("#gmap").width(iWidth - 32 - 402);
                }

                $(window).ready(function() {
                    resize_map();
                });

                $(window).resize(function() {
                    resize_map();
                });

                $(document).on('pageshow', '#map', function(e, data) {

                    var iHeight = $('#map').height();

                    $('#contenedor').height(iHeight - 155 - 65 - 15 - 2 - 51);

                    localizar();
                });

                function callMap() {
                    resize_map();
                    google.maps.event.trigger(gmap, "resize");
                }
                
            </script>
        </f:facet>

        <!-- Main View -->
        <pm:view id="map">
            <pm:content id="contenedor">
                <h:form id="formMap">
                    <p:gmap center="0,0" type="ROADMAP"  widgetVar="gmap" id="gmap" zoom="16" style="height: 682px;width: 100%"/>
                </h:form>
            </pm:content>
        </pm:view>
    </pm:page>

</f:view>
